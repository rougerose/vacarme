#CACHE{0}
<BOUCLE_commande(COMMANDES){id_commande=#ENV{id_commande}}{statut IN encours, poubelle}>
	#SET{articles_offerts, #ARRAY}
	#SET{articles_perso, #ARRAY}
	#SET{id_adresse, ''}
	#SET{valider, ''}
	<BOUCLE_contenu_commande(COMMANDES_DETAILS){id_commande}>
		[(#OBJET|=={abonnements_offre}|oui)
			[(#DESCRIPTIF|match{offert@}|?{
				[(#SET{articles_offerts, #GET{articles_offerts}|push{#ID_OBJET}})],
				[(#SET{articles_perso, #GET{articles_perso}|push{#ID_OBJET}})]
			})]
		]
		[(#OBJET|match{produit|rubrique}|oui)
			#SET{articles_perso, #GET{articles_perso}|push{#ID_OBJET}}
		]
	</BOUCLE_contenu_commande>

	<section class="c-section c-commande-section c-commande-adresse">
		<h2 class="c-section__titre--small c-commande-section__titre u-typo-font-vacarme"><:vacarme:commande_adresse_titre:></h2>
		[(#REM) article(s) perso ]
		<BOUCLE_adresse_articles_perso(ADRESSES){id_auteur}{type=pref}{0,1}{si #GET{articles_perso}|count|>{0}}>
			#SET{id_adresse, #ID_ADRESSE}
			[<p class="c-commande-adresse__info"><span>(#GET{articles_perso}|count|singulier_ou_pluriel{vacarme:commande_message_adresse_article_perso, vacarme:commande_message_adresse_articles_perso})<strong>[(#ORGANISATION)][ (#SERVICE),][ (#VOIE)][, (#COMPLEMENT)][, (#BOITE_POSTALE)][ (#CODE_POSTAL)][ (#VILLE)][ (#REGION)][ (#PAYS)].</strong></span>[ <span><a href="(#URL_PAGE{compte}|parametre_url{section, informations}|parametre_url{retour, #SELF})" class="c-btn c-btn--black u-typo-font-vacarme u-typo-upper"><:vacarme:commande_adresse_bouton_modifier:></a></span>]</p>]
		</BOUCLE_adresse_articles_perso>
			<p class="c-message c-message--erreur"><:vacarme:commande_erreur_adresse_inexistante:><br>[<a href="(#URL_PAGE{compte}|parametre_url{section, informations}|parametre_url{retour, #SELF})" class="c-btn c-btn--black c-btn--margin u-typo-font-vacarme u-typo-upper"><:vacarme:commande_adresse_bouton_ajouter:></a>]</p>
		<//B_adresse_articles_perso>
		[(#REM) article(s) offert(s) ]
		[(#GET{articles_offerts}|count|>{0}|oui)
			[<p class"c-commande-adresse__info">(#GET{articles_offerts}|count|singulier_ou_pluriel{vacarme:commande_message_adresse_article_offert,vacarme:commande_message_adresse_articles_offerts}).</p>]
		]
	</section>
	[(#STATUT|=={poubelle}|oui)
		<div class="c-commande-articles est-vide">
			<p class="c-message c-message--ok"><:vacarme:commande_message_annulation:>.</p>
		</div>
	][(#STATUT|=={encours}|oui)
		[(#INCLURE{fond=inclure/commande/contenu, id_commande})]
		
		[(#REM)
			<!-- 
				Tester si l'adresse postale existe pour les articles destinÃ©s au payeur.
			-->
		][(#GET{articles_perso}|et{#GET{id_adresse}}|?{[(#SET{valider, ' '})]})]
		[(#GET{articles_offerts}|oui) [(#GET{articles_perso}|non) [(#SET{valider, ' '})] ]]
		[(#GET{valider}|oui)
			<div class="c-btn-multiples c-commande-actions">
				[(#BOUTON_ACTION{<:vacarme:commande_bouton_annuler:>, 
					#URL_ACTION_AUTEUR{abandonner_commande, #ID_COMMANDE, #SELF},
					c-btn-form c-btn-form--secondaire c-btn-form--annuler c-btn-form--round c-btn-form--upper u-typo-font-vacarme})]
				[<a href="(#SELF|parametre_url{etape, paiement})" class="c-btn c-btn--submit c-btn--round c-btn--primaire u-typo-font-vacarme c-btn--upper"><:vacarme:commande_bouton_payer:></a>]
			</div>
		][(#GET{valider}|non)
			<p class="c-message c-message--erreur"><:vacarme:commande_erreur_adresse_inexistante:><br>[<a href="(#URL_PAGE{compte}|parametre_url{section, informations}|parametre_url{retour, #SELF})" class="c-btn c-btn--black c-btn--margin u-typo-font-vacarme u-typo-upper"><:vacarme:commande_adresse_bouton_ajouter:></a>]</p>
		]
	]
</BOUCLE_commande>
	<div class="c-commande-articles est-vide">
		<p class="c-message c-message--erreur"><:vacarme:commande_inexistante:></p>
	</div>
<//B_commande>
